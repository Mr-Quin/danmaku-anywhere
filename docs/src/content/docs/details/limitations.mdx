---
title: 工作原理
description: 工作原理
---

此插件的三个基本功能：
1. 获取弹幕（用户提供，内置搜索）
2. 在网页上注入弹幕
3. 将弹幕与视频同步（时间，位置）


## 匹配网页

插件安装时会请求所有网站的权限，但是并不是所有网站都需要弹幕，所以需要[装填配置](/details/mount-profile)来告诉插件哪些网页需要弹幕。

通过白名单的方式，只有在配置中指定的网址模式才会注入脚本，进而注入弹幕。同时装填配置可以用来关联网址和其他配置，比如适配，弹幕样式（未实装）等。

## 限制

### 弹幕互动

插件提供的弹幕是静态的，不支持用户互动，例如鼠标悬停，点击等。

这是因为为了保证弹幕始终显示在视频上方（包括视频全屏的情况下），弹幕使用 [Top Layer](https://developer.mozilla.org/en-US/docs/Glossary/Top_layer) 的方式实现。
这种方式虽然最大化弹幕和网站的兼容性，但是会导致弹幕下方的元素（比如视频控件等）无法被点击，为了解决这个问题给弹幕层设置`pointer-events: none`，这样可以避免弹幕层拦截点击事件，但是也导致弹幕无法接收用户互动。

### `iframe`

对插件来说，网页和网页内的`iframe`是两个不同的网页。如果视频位于`iframe`中，而装填配置匹配到了网页，但是没有匹配到`iframe`，那么插件将无法获取到视频元素，导致无法正常工作。

### Shadow DOM

[Shadow DOM](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM) 会阻止脚本访问元素，

如果一个网站的视频元素位于 Shadow DOM 中，插件无法直接访问到视频元素，导致无法正常工作。

目前无解，但是也没有遇到过这种情况。
